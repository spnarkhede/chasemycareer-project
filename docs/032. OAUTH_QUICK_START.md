# Google OAuth with PKCE - Quick Start Guide

## ğŸš€ Quick Setup (5 Minutes)

### 1. Get Google OAuth Credentials

1. Visit [Google Cloud Console](https://console.cloud.google.com/apis/credentials)
2. Create OAuth 2.0 Client ID (Web application)
3. Add redirect URI: `http://localhost:5173/auth/callback`
4. Copy **Client ID** and **Client Secret**

### 2. Configure Environment

Update `.env`:
```env
VITE_GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
```

Update Supabase Secrets (Project Settings > Edge Functions > Secrets):
```
GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-client-secret
```

### 3. Enable Google Calendar API

1. Go to [API Library](https://console.cloud.google.com/apis/library)
2. Search "Google Calendar API"
3. Click "Enable"

### 4. Test the Integration

1. Start the application
2. Navigate to `/google-calendar`
3. Click "Connect Google Calendar"
4. Grant permissions
5. Create and view events

## ğŸ“‹ Key Features

### PKCE Security Flow
- âœ… Code verifier generated client-side
- âœ… Code challenge sent to Google
- âœ… Server-side token exchange
- âœ… Client secret never exposed

### Token Management
- âœ… Secure database storage
- âœ… Automatic token refresh
- âœ… Row-level security policies
- âœ… Encrypted at rest

### Calendar Operations
- âœ… List events
- âœ… Create events
- âœ… Update events
- âœ… Delete events
- âœ… Filter by date range

## ğŸ”§ Usage Examples

### Connect Calendar
```typescript
import { OAuthService } from '@/services/oauth.service';

const authUrl = await OAuthService.initiateGoogleOAuth();
window.location.href = authUrl;
```

### Create Event
```typescript
import { CalendarService } from '@/services/calendar.service';

const event = await CalendarService.createEvent({
  summary: 'Team Meeting',
  start: { dateTime: '2025-12-15T10:00:00' },
  end: { dateTime: '2025-12-15T11:00:00' }
});
```

### List Events
```typescript
const events = await CalendarService.getUpcomingEvents(7);
```

## ğŸ” Security Checklist

- [x] PKCE implementation
- [x] State parameter validation
- [x] Server-side token exchange
- [x] Client secret in Edge Functions only
- [x] RLS policies on tokens table
- [x] Automatic token refresh
- [x] httpOnly session cookies

## ğŸ“ File Structure

```
src/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ oauth.service.ts       # PKCE OAuth flow
â”‚   â””â”€â”€ calendar.service.ts    # Calendar API calls
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ Calendar.tsx           # Main calendar UI
â”‚   â””â”€â”€ auth/
â”‚       â””â”€â”€ OAuthCallback.tsx  # OAuth callback handler
â””â”€â”€ types/
    â””â”€â”€ index.ts               # TypeScript types

supabase/
â”œâ”€â”€ functions/
â”‚   â”œâ”€â”€ exchange-google-token/ # Token exchange
â”‚   â””â”€â”€ refresh-google-token/  # Token refresh
â””â”€â”€ migrations/
    â””â”€â”€ 00004_create_oauth_tokens_table.sql
```

## ğŸ› Troubleshooting

### "Missing Google OAuth credentials"
â†’ Check Supabase secrets are set correctly

### "Invalid callback"
â†’ Verify redirect URI matches Google Console

### "Token exchange failed"
â†’ Check Edge Function logs in Supabase dashboard

### "No access token available"
â†’ User needs to connect calendar first

## ğŸ“š Documentation

- Full Setup Guide: `GOOGLE_OAUTH_CALENDAR_SETUP.md`
- OAuth Flow Details: See architecture section in setup guide
- API Reference: See services documentation

## ğŸ¯ Production Deployment

1. Update redirect URIs with production domain
2. Update environment variables
3. Update Supabase secrets
4. Test complete OAuth flow
5. Monitor Edge Function logs

## ğŸ’¡ Tips

- Test with Google test users first
- Monitor token refresh logs
- Set up error tracking
- Review RLS policies regularly
- Keep client secret secure

## ğŸ”— Resources

- [Google OAuth 2.0](https://developers.google.com/identity/protocols/oauth2)
- [Google Calendar API](https://developers.google.com/calendar/api)
- [PKCE Specification](https://tools.ietf.org/html/rfc7636)
- [Supabase Edge Functions](https://supabase.com/docs/guides/functions)
