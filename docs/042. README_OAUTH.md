# Google OAuth with PKCE - README

## ğŸ¯ What is This?

This is a complete, production-ready implementation of Google OAuth 2.0 with PKCE (Proof Key for Code Exchange) and Google Calendar API integration. It demonstrates security best practices for OAuth flows in modern web applications.

## ğŸ”‘ Key Features

### Security First
- âœ… **PKCE Implementation**: Enhanced security for public clients
- âœ… **Server-Side Token Exchange**: Client secret never exposed
- âœ… **State Parameter**: CSRF attack prevention
- âœ… **Secure Token Storage**: Database with Row Level Security
- âœ… **Automatic Token Refresh**: Seamless user experience

### Google Calendar Integration
- âœ… **List Events**: View upcoming calendar events
- âœ… **Create Events**: Add new events to calendar
- âœ… **Update Events**: Modify existing events
- âœ… **Delete Events**: Remove events from calendar
- âœ… **Date Filtering**: Filter events by date range

### Developer Experience
- âœ… **TypeScript**: Full type safety
- âœ… **Modular Architecture**: Clean separation of concerns
- âœ… **Comprehensive Documentation**: Multiple guides available
- âœ… **Error Handling**: User-friendly error messages
- âœ… **Loading States**: Clear user feedback

## ğŸ“š Documentation

### Quick Start
Start here for a 5-minute setup:
- **[OAUTH_QUICK_START.md](./OAUTH_QUICK_START.md)**

### Complete Setup Guide
Comprehensive instructions for production deployment:
- **[GOOGLE_OAUTH_CALENDAR_SETUP.md](./GOOGLE_OAUTH_CALENDAR_SETUP.md)**

### Visual Flow Diagrams
Understand the OAuth flow with visual diagrams:
- **[OAUTH_FLOW_DIAGRAM.md](./OAUTH_FLOW_DIAGRAM.md)**

### Implementation Details
Technical summary of what was built:
- **[IMPLEMENTATION_SUMMARY_OAUTH.md](./IMPLEMENTATION_SUMMARY_OAUTH.md)**

## ğŸš€ Quick Setup

### 1. Get Google Credentials
```bash
# Visit Google Cloud Console
https://console.cloud.google.com/apis/credentials

# Create OAuth 2.0 Client ID
# Add redirect URI: http://localhost:5173/auth/callback
# Copy Client ID and Client Secret
```

### 2. Configure Environment
```bash
# Update .env
VITE_GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com

# Update Supabase Secrets (in dashboard)
GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-client-secret
```

### 3. Enable Google Calendar API
```bash
# Visit API Library
https://console.cloud.google.com/apis/library

# Search and enable "Google Calendar API"
```

### 4. Test
```bash
# Start the application
npm run dev

# Navigate to /google-calendar
# Click "Connect Google Calendar"
# Grant permissions
# Create and view events
```

## ğŸ“ Project Structure

```
src/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ oauth.service.ts       # PKCE OAuth flow
â”‚   â””â”€â”€ calendar.service.ts    # Calendar API calls
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ Calendar.tsx           # Main calendar UI
â”‚   â””â”€â”€ auth/
â”‚       â””â”€â”€ OAuthCallback.tsx  # OAuth callback handler
â””â”€â”€ types/
    â””â”€â”€ index.ts               # TypeScript types

supabase/
â”œâ”€â”€ functions/
â”‚   â”œâ”€â”€ exchange-google-token/ # Token exchange
â”‚   â””â”€â”€ refresh-google-token/  # Token refresh
â””â”€â”€ migrations/
    â””â”€â”€ 00004_create_oauth_tokens_table.sql
```

## ğŸ” Security Architecture

### OAuth Flow
```
1. User clicks "Connect Calendar"
2. Generate PKCE verifier & challenge
3. Redirect to Google with challenge
4. User authenticates at Google
5. Google redirects back with code
6. Edge Function exchanges code (with secret)
7. Tokens stored in database
8. User can access calendar
```

### Token Management
```
1. Access token stored in database
2. Refresh token stored securely
3. Automatic refresh before expiration
4. RLS policies enforce access control
5. httpOnly cookies for sessions
```

## ğŸ’» Usage Examples

### Connect Calendar
```typescript
import { OAuthService } from '@/services/oauth.service';

const authUrl = await OAuthService.initiateGoogleOAuth();
window.location.href = authUrl;
```

### Create Event
```typescript
import { CalendarService } from '@/services/calendar.service';

const event = await CalendarService.createEvent({
  summary: 'Team Meeting',
  description: 'Discuss project updates',
  start: { dateTime: '2025-12-15T10:00:00' },
  end: { dateTime: '2025-12-15T11:00:00' },
  location: 'Conference Room A'
});
```

### List Events
```typescript
// Get next 7 days
const events = await CalendarService.getUpcomingEvents(7);

// Get today's events
const todayEvents = await CalendarService.getTodayEvents();

// Custom date range
const events = await CalendarService.listEvents(
  50,
  '2025-12-01T00:00:00Z',
  '2025-12-31T23:59:59Z'
);
```

## ğŸ§ª Testing

### Manual Testing Checklist
- [ ] OAuth flow initiation
- [ ] Google authentication
- [ ] Permission grant
- [ ] Callback processing
- [ ] Token storage
- [ ] Token refresh
- [ ] Event listing
- [ ] Event creation
- [ ] Event deletion
- [ ] Disconnect functionality

### Security Testing
- [ ] PKCE validation
- [ ] State parameter validation
- [ ] Token expiration handling
- [ ] RLS policy enforcement
- [ ] Client secret protection

## ğŸ› Troubleshooting

### Common Issues

**"Missing Google OAuth credentials"**
â†’ Check Supabase secrets are set correctly

**"Invalid callback"**
â†’ Verify redirect URI matches Google Console

**"Token exchange failed"**
â†’ Check Edge Function logs in Supabase dashboard

**"No access token available"**
â†’ User needs to connect calendar first

## ğŸ“Š API Endpoints

### Edge Functions
```
POST /functions/v1/exchange-google-token
Body: { code, code_verifier, redirect_uri }
Returns: { access_token, refresh_token, expires_in, scope }

POST /functions/v1/refresh-google-token
Body: { refresh_token }
Returns: { access_token, expires_in, scope }
```

### Google Calendar API
```
GET /calendar/v3/calendars/primary/events
POST /calendar/v3/calendars/primary/events
PUT /calendar/v3/calendars/primary/events/{eventId}
DELETE /calendar/v3/calendars/primary/events/{eventId}
```

## ğŸ“ Learning Resources

### Specifications
- [OAuth 2.0 RFC 6749](https://tools.ietf.org/html/rfc6749)
- [PKCE RFC 7636](https://tools.ietf.org/html/rfc7636)

### Google Documentation
- [Google OAuth 2.0](https://developers.google.com/identity/protocols/oauth2)
- [Google Calendar API](https://developers.google.com/calendar/api)

### Supabase
- [Edge Functions](https://supabase.com/docs/guides/functions)
- [Row Level Security](https://supabase.com/docs/guides/auth/row-level-security)

## ğŸ¯ Production Checklist

- [ ] Update redirect URIs with production domain
- [ ] Set production environment variables
- [ ] Update Supabase secrets
- [ ] Test complete OAuth flow
- [ ] Monitor Edge Function logs
- [ ] Set up error tracking
- [ ] Configure rate limiting
- [ ] Review RLS policies
- [ ] Test token refresh
- [ ] Verify security measures

## ğŸ¤ Contributing

This implementation follows best practices:
- TypeScript for type safety
- Modular architecture
- Comprehensive error handling
- Security-first approach
- Clear documentation

## ğŸ“„ License

This implementation is part of a larger application. Refer to the main project license.

## ğŸ™ Acknowledgments

- Google OAuth 2.0 team for excellent documentation
- Supabase team for Edge Functions and database
- PKCE specification authors for enhanced security
- React and TypeScript communities

## ğŸ“ Support

For questions or issues:
1. Check the documentation guides
2. Review the flow diagrams
3. Verify configuration
4. Check logs (browser console, Edge Functions)
5. Review database state

## ğŸ‰ Success!

You now have a production-ready OAuth implementation with:
- âœ… PKCE security
- âœ… Server-side token exchange
- âœ… Automatic token refresh
- âœ… Google Calendar integration
- âœ… Comprehensive documentation

**Next Steps**: Configure your Google OAuth credentials and start building!
