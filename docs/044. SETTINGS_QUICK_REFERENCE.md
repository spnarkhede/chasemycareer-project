# Settings System - Quick Reference

## üöÄ Quick Start

### Access Settings
```typescript
// Navigate to settings
navigate('/settings');

// Direct tab access
navigate('/settings?tab=profile');
navigate('/settings?tab=job-search');
navigate('/settings?tab=notifications');
navigate('/settings?tab=security');
navigate('/settings?tab=customization');
```

### Get User Preferences
```typescript
import { useAuth } from '@/contexts/AuthContext';

const { profile } = useAuth();

// Access preferences
const country = profile?.preferred_country;
const language = profile?.preferred_language;
const currency = profile?.preferred_currency;
const intensity = profile?.job_search_intensity;
```

### Update Preferences
```typescript
import { supabase } from '@/db/supabase';

const { error } = await supabase
  .from('profiles')
  .update({
    preferred_country: 'germany',
    preferred_currency: 'EUR',
    preferred_language: 'de'
  })
  .eq('id', user?.id);
```

---

## üìä Available Settings

### Profile Preferences
| Field | Type | Default | Options |
|-------|------|---------|---------|
| `preferred_country` | string | null | australia, canada, europe, germany, india, uk, usa |
| `preferred_language` | string | 'en' | en, de |
| `preferred_currency` | string | 'USD' | USD, EUR, GBP, INR |
| `timezone` | string | null | Any valid timezone |

### Job Search Preferences
| Field | Type | Default | Options |
|-------|------|---------|---------|
| `target_role` | string | null | Any job role |
| `target_industry` | string | null | Any industry |
| `experience_level` | string | null | entry, mid, senior, lead, principal |
| `job_search_intensity` | string | 'moderate' | light, moderate, high |
| `resume_format_preference` | string | 'ats_standard' | ats_standard, modern, german_cv, compact |

### Notification Preferences
| Field | Type | Default |
|-------|------|---------|
| `email_notifications` | boolean | true |
| `daily_reminders` | boolean | true |
| `interview_alerts` | boolean | true |

### App Customization
| Field | Type | Default | Options |
|-------|------|---------|---------|
| `ui_theme` | string | 'system' | light, dark, system |
| `layout_density` | string | 'comfortable' | compact, comfortable, spacious |

---

## üõ†Ô∏è Helper Functions

### Currency Formatting
```typescript
import { formatCurrency } from '@/constants/settings';

const formatted = formatCurrency(80000, 'USD'); // "$80,000"
const formatted = formatCurrency(60000, 'EUR'); // "‚Ç¨60,000"
```

### Get Job Portals
```typescript
import { getJobPortals } from '@/constants/settings';

const portals = getJobPortals('germany');
// Returns: [
//   { name: 'LinkedIn DE', url: 'https://...' },
//   { name: 'StepStone', url: 'https://...' },
//   ...
// ]
```

### Get Default Currency
```typescript
import { getDefaultCurrency } from '@/constants/settings';

const currency = getDefaultCurrency('germany'); // 'EUR'
const currency = getDefaultCurrency('usa'); // 'USD'
```

### Get Timezone
```typescript
import { getTimezoneForCountry } from '@/constants/settings';

const tz = getTimezoneForCountry('germany'); // 'Europe/Berlin'
const tz = getTimezoneForCountry('usa'); // 'America/New_York'
```

---

## üé® Using Constants

### Import Constants
```typescript
import {
  COUNTRIES,
  LANGUAGES,
  CURRENCIES,
  EXPERIENCE_LEVELS,
  JOB_SEARCH_INTENSITIES,
  RESUME_FORMATS,
  UI_THEMES,
  LAYOUT_DENSITIES,
  JOB_ROLES,
  INDUSTRIES,
  JOB_PORTALS
} from '@/constants/settings';
```

### Example Usage
```typescript
// Display country dropdown
{COUNTRIES.map((country) => (
  <option key={country.value} value={country.value}>
    {country.flag} {country.label}
  </option>
))}

// Get intensity details
const intensity = JOB_SEARCH_INTENSITIES.find(i => i.value === 'moderate');
console.log(intensity.tasksPerDay); // 5

// Get resume format info
const format = RESUME_FORMATS.find(f => f.value === 'german_cv');
console.log(format.bestFor); // 'Germany, Austria, Switzerland'
```

---

## üîÑ Integration Examples

### Adjust Tasks by Intensity
```typescript
const getTasksPerDay = (intensity: string) => {
  const config = JOB_SEARCH_INTENSITIES.find(i => i.value === intensity);
  return config?.tasksPerDay || 5;
};

const tasksToShow = getTasksPerDay(profile?.job_search_intensity);
```

### Display Salary in User's Currency
```typescript
import { formatCurrency } from '@/constants/settings';

const DisplaySalary = ({ amount }: { amount: number }) => {
  const { profile } = useAuth();
  const currency = profile?.preferred_currency || 'USD';
  
  return <span>{formatCurrency(amount, currency)}</span>;
};
```

### Show Job Portals for User's Country
```typescript
import { getJobPortals } from '@/constants/settings';

const JobPortalLinks = () => {
  const { profile } = useAuth();
  const portals = getJobPortals(profile?.preferred_country);
  
  return (
    <div>
      {portals.map(portal => (
        <a key={portal.name} href={portal.url} target="_blank">
          {portal.name}
        </a>
      ))}
    </div>
  );
};
```

### Apply Theme
```typescript
const applyTheme = (theme: string) => {
  if (theme === 'dark') {
    document.documentElement.classList.add('dark');
  } else if (theme === 'light') {
    document.documentElement.classList.remove('dark');
  } else {
    // System theme
    const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (isDark) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  }
};
```

---

## üì± Component Examples

### Settings Link in Navigation
```typescript
import { Settings } from 'lucide-react';
import { Link } from 'react-router-dom';

<Link to="/settings">
  <Button variant="ghost" size="icon">
    <Settings className="w-4 h-4" />
  </Button>
</Link>
```

### Check if User Has Completed Preferences
```typescript
const hasCompletedPreferences = (profile: Profile) => {
  return !!(
    profile?.preferred_country &&
    profile?.target_role &&
    profile?.experience_level
  );
};

// Redirect to settings if incomplete
if (!hasCompletedPreferences(profile)) {
  navigate('/settings');
}
```

### Display Preference Badge
```typescript
import { Badge } from '@/components/ui/badge';

const PreferenceBadge = () => {
  const { profile } = useAuth();
  const country = COUNTRIES.find(c => c.value === profile?.preferred_country);
  
  return (
    <Badge variant="secondary">
      {country?.flag} {country?.label}
    </Badge>
  );
};
```

---

## üîç Querying Preferences

### Get All User Preferences
```typescript
const { data, error } = await supabase
  .from('profiles')
  .select('*')
  .eq('id', userId)
  .maybeSingle();
```

### Get Specific Preferences
```typescript
const { data, error } = await supabase
  .from('profiles')
  .select('preferred_country, preferred_language, preferred_currency')
  .eq('id', userId)
  .maybeSingle();
```

### Update Multiple Preferences
```typescript
const { error } = await supabase
  .from('profiles')
  .update({
    preferred_country: 'germany',
    preferred_language: 'de',
    preferred_currency: 'EUR',
    timezone: 'Europe/Berlin',
    target_role: 'Software Engineer',
    experience_level: 'mid'
  })
  .eq('id', userId);
```

---

## üéØ Common Patterns

### Smart Country Selection
```typescript
const handleCountryChange = (country: string) => {
  // Auto-update related fields
  const currency = getDefaultCurrency(country);
  const timezone = getTimezoneForCountry(country);
  
  await supabase
    .from('profiles')
    .update({
      preferred_country: country,
      preferred_currency: currency,
      timezone: timezone
    })
    .eq('id', userId);
};
```

### Conditional Content Based on Preferences
```typescript
const { profile } = useAuth();

// Show different content based on country
if (profile?.preferred_country === 'germany') {
  return <GermanJobTips />;
} else if (profile?.preferred_country === 'usa') {
  return <USJobTips />;
}

// Adjust language
const content = profile?.preferred_language === 'de' 
  ? germanContent 
  : englishContent;
```

### Validate Preferences
```typescript
const validatePreferences = (data: Partial<Profile>) => {
  const errors: string[] = [];
  
  if (data.preferred_language && !['en', 'de'].includes(data.preferred_language)) {
    errors.push('Invalid language');
  }
  
  if (data.preferred_currency && !['USD', 'EUR', 'GBP', 'INR'].includes(data.preferred_currency)) {
    errors.push('Invalid currency');
  }
  
  return errors;
};
```

---

## üêõ Troubleshooting

### Settings Not Saving
```typescript
// Check for errors
const { error } = await supabase
  .from('profiles')
  .update(data)
  .eq('id', userId);

if (error) {
  console.error('Save error:', error);
  toast.error('Failed to save settings');
}
```

### Preferences Not Loading
```typescript
// Ensure user is authenticated
if (!user) {
  console.error('User not authenticated');
  return;
}

// Check query
const { data, error } = await supabase
  .from('profiles')
  .select('*')
  .eq('id', user.id)
  .maybeSingle();

if (error) {
  console.error('Load error:', error);
}
```

### Theme Not Applying
```typescript
// Check theme value
console.log('Current theme:', profile?.ui_theme);

// Manually apply theme
const theme = profile?.ui_theme || 'system';
applyTheme(theme);
```

---

## üìö Related Files

- **Main Settings Page:** `src/pages/Settings.tsx`
- **Profile Settings:** `src/pages/settings/ProfileSettings.tsx`
- **Job Search Settings:** `src/pages/settings/JobSearchSettings.tsx`
- **Notification Settings:** `src/pages/settings/NotificationSettings.tsx`
- **App Customization:** `src/pages/settings/AppCustomization.tsx`
- **Security Settings:** `src/pages/settings/SecuritySettingsPage.tsx`
- **Constants:** `src/constants/settings.ts`
- **Types:** `src/types/index.ts`
- **Migration:** `supabase/migrations/00005_add_user_preferences.sql`

---

## üéì Best Practices

1. **Always validate user input** before saving
2. **Provide default values** for all preferences
3. **Show loading states** during save operations
4. **Display success/error messages** for user feedback
5. **Auto-save when possible** to improve UX
6. **Use constants** instead of hardcoded values
7. **Handle null values** gracefully
8. **Test with different preference combinations**
9. **Consider mobile responsiveness**
10. **Document any new preference fields**

---

**Quick Links:**
- [Full Documentation](./SETTINGS_SYSTEM.md)
- [Migration File](./supabase/migrations/00005_add_user_preferences.sql)
- [Constants File](./src/constants/settings.ts)
- [Types File](./src/types/index.ts)
