# Google OAuth Setup Checklist

## ‚úÖ Pre-Configuration Checklist

Before you can use the Google OAuth and Calendar integration, complete these steps:

### 1. Google Cloud Console Setup

#### Create Project (if needed)
- [ ] Go to [Google Cloud Console](https://console.cloud.google.com/)
- [ ] Create a new project or select existing one
- [ ] Note your project ID

#### Enable APIs
- [ ] Navigate to "APIs & Services" > "Library"
- [ ] Search for "Google Calendar API"
- [ ] Click "Enable"
- [ ] Wait for API to be enabled (may take a few seconds)

#### Create OAuth 2.0 Credentials
- [ ] Go to "APIs & Services" > "Credentials"
- [ ] Click "Create Credentials" > "OAuth client ID"
- [ ] If prompted, configure OAuth consent screen first (see below)
- [ ] Choose "Web application" as application type
- [ ] Enter a name (e.g., "Job Search App")
- [ ] Add Authorized JavaScript origins:
  - [ ] `http://localhost:5173` (for development)
  - [ ] `https://yourdomain.com` (for production)
- [ ] Add Authorized redirect URIs:
  - [ ] `http://localhost:5173/auth/callback` (for development)
  - [ ] `https://yourdomain.com/auth/callback` (for production)
- [ ] Click "Create"
- [ ] **IMPORTANT**: Copy the Client ID and Client Secret immediately

#### Configure OAuth Consent Screen
- [ ] Go to "APIs & Services" > "OAuth consent screen"
- [ ] Choose "External" (or "Internal" if using Google Workspace)
- [ ] Fill in App Information:
  - [ ] App name
  - [ ] User support email
  - [ ] App logo (optional)
- [ ] Add App domain (optional):
  - [ ] Application home page
  - [ ] Application privacy policy link
  - [ ] Application terms of service link
- [ ] Add Developer contact information
- [ ] Click "Save and Continue"
- [ ] Add Scopes:
  - [ ] Click "Add or Remove Scopes"
  - [ ] Select: `openid`
  - [ ] Select: `email`
  - [ ] Select: `profile`
  - [ ] Search and add: `https://www.googleapis.com/auth/calendar.events`
  - [ ] Click "Update"
  - [ ] Click "Save and Continue"
- [ ] Add Test Users (if in testing mode):
  - [ ] Click "Add Users"
  - [ ] Enter email addresses of test users
  - [ ] Click "Add"
  - [ ] Click "Save and Continue"
- [ ] Review summary and click "Back to Dashboard"

### 2. Application Configuration

#### Update Environment Variables
- [ ] Open `.env` file in project root
- [ ] Replace `YOUR_GOOGLE_CLIENT_ID_HERE` with your actual Client ID:
  ```env
  VITE_GOOGLE_CLIENT_ID=1234567890-abcdefghijklmnop.apps.googleusercontent.com
  ```
- [ ] Save the file

#### Update Supabase Secrets
- [ ] Go to your Supabase project dashboard
- [ ] Navigate to "Project Settings" > "Edge Functions" > "Secrets"
- [ ] Update or create these secrets:
  - [ ] `GOOGLE_CLIENT_ID`: Your Google OAuth Client ID
  - [ ] `GOOGLE_CLIENT_SECRET`: Your Google OAuth Client Secret
- [ ] Click "Save" for each secret

### 3. Verification

#### Test OAuth Flow
- [ ] Start the application: `npm run dev`
- [ ] Navigate to `http://localhost:5173`
- [ ] Log in to the application
- [ ] Navigate to `/google-calendar`
- [ ] Click "Connect Google Calendar"
- [ ] You should be redirected to Google
- [ ] Authenticate with a test user account
- [ ] Grant the requested permissions
- [ ] You should be redirected back to the application
- [ ] Verify you see "Authentication successful!"
- [ ] You should be redirected to the dashboard

#### Test Calendar Integration
- [ ] Navigate to `/google-calendar`
- [ ] Verify you see the calendar interface
- [ ] Click "Create Event"
- [ ] Fill in event details:
  - [ ] Event title
  - [ ] Description
  - [ ] Start time
  - [ ] End time
  - [ ] Location
- [ ] Click "Create Event"
- [ ] Verify the event appears in the list
- [ ] Verify the event appears in your Google Calendar

#### Test Token Refresh
- [ ] Wait for token to expire (or manually set short expiration)
- [ ] Try to list events again
- [ ] Verify token is automatically refreshed
- [ ] Verify events are still accessible

### 4. Database Verification

#### Check Token Storage
- [ ] Go to Supabase dashboard
- [ ] Navigate to "Table Editor"
- [ ] Open `oauth_tokens` table
- [ ] Verify you see a row with:
  - [ ] Your user_id
  - [ ] provider: 'google'
  - [ ] access_token (encrypted)
  - [ ] refresh_token (encrypted)
  - [ ] expires_at (future timestamp)
  - [ ] scopes array

#### Check RLS Policies
- [ ] In Supabase dashboard, go to "Authentication" > "Policies"
- [ ] Verify `oauth_tokens` table has RLS enabled
- [ ] Verify policies exist for:
  - [ ] Users can view own tokens
  - [ ] Users can insert own tokens
  - [ ] Users can update own tokens
  - [ ] Users can delete own tokens
  - [ ] Admins have full access

### 5. Edge Functions Verification

#### Check Function Deployment
- [ ] Go to Supabase dashboard
- [ ] Navigate to "Edge Functions"
- [ ] Verify these functions are deployed:
  - [ ] `exchange-google-token` (status: ACTIVE)
  - [ ] `refresh-google-token` (status: ACTIVE)

#### Check Function Logs
- [ ] Click on `exchange-google-token`
- [ ] Go to "Logs" tab
- [ ] Verify no errors during token exchange
- [ ] Click on `refresh-google-token`
- [ ] Go to "Logs" tab
- [ ] Verify no errors during token refresh

### 6. Security Verification

#### PKCE Implementation
- [ ] Open browser DevTools
- [ ] Go to "Application" > "Session Storage"
- [ ] Initiate OAuth flow
- [ ] Verify `pkce_verifier` is stored temporarily
- [ ] Verify `oauth_state` is stored temporarily
- [ ] Complete OAuth flow
- [ ] Verify both are cleared after successful authentication

#### Token Security
- [ ] Verify Client Secret is NOT in `.env` file
- [ ] Verify Client Secret is NOT in any frontend code
- [ ] Verify Client Secret is only in Supabase secrets
- [ ] Verify tokens are stored in database, not localStorage
- [ ] Verify tokens are only accessible by the owner (RLS)

### 7. Production Preparation

#### Update Configuration
- [ ] Update Google OAuth redirect URIs with production domain
- [ ] Update `.env` with production values
- [ ] Update Supabase secrets if needed
- [ ] Test OAuth flow in production environment

#### Monitoring Setup
- [ ] Set up error tracking (e.g., Sentry)
- [ ] Configure logging for Edge Functions
- [ ] Set up alerts for failed OAuth attempts
- [ ] Monitor token refresh rates

#### Performance Optimization
- [ ] Verify token refresh happens before expiration
- [ ] Check database query performance
- [ ] Monitor API call rates to Google
- [ ] Set up caching if needed

## üìã Quick Reference

### Environment Variables
```env
VITE_GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
```

### Supabase Secrets
```
GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-client-secret
```

### Redirect URIs
```
Development: http://localhost:5173/auth/callback
Production: https://yourdomain.com/auth/callback
```

### Required Scopes
```
openid
email
profile
https://www.googleapis.com/auth/calendar.events
```

## üéØ Success Criteria

You've successfully configured Google OAuth when:
- ‚úÖ OAuth flow completes without errors
- ‚úÖ Tokens are stored in database
- ‚úÖ Calendar events can be listed
- ‚úÖ Calendar events can be created
- ‚úÖ Tokens refresh automatically
- ‚úÖ No client secret in frontend code
- ‚úÖ RLS policies enforce security

## üêõ Troubleshooting

If something doesn't work, check:
1. [ ] Google Cloud Console configuration
2. [ ] Environment variables are correct
3. [ ] Supabase secrets are set
4. [ ] Redirect URIs match exactly
5. [ ] Google Calendar API is enabled
6. [ ] Edge Functions are deployed
7. [ ] Database migration is applied
8. [ ] Browser console for errors
9. [ ] Edge Function logs for errors
10. [ ] Network tab for failed requests

## üìö Documentation

For detailed information, see:
- **Quick Start**: `OAUTH_QUICK_START.md`
- **Complete Setup**: `GOOGLE_OAUTH_CALENDAR_SETUP.md`
- **Flow Diagrams**: `OAUTH_FLOW_DIAGRAM.md`
- **Implementation Details**: `IMPLEMENTATION_SUMMARY_OAUTH.md`

## ‚ú® You're Ready!

Once all checkboxes are complete, your Google OAuth with PKCE and Calendar integration is fully configured and ready to use!
