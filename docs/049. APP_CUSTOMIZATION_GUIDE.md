# App Customization System - Complete Guide

## Overview

The application now features a comprehensive customization system that allows users to personalize their experience with theme preferences (light/dark/system) and layout density options (compact/comfortable/spacious).

## Features

### 1. Theme Customization
- **Light Mode**: Bright, high-contrast interface for better visibility
- **Dark Mode**: Reduced eye strain with dark backgrounds
- **System Mode**: Automatically matches your operating system's theme preference

### 2. Layout Density
- **Compact**: More content with reduced spacing - ideal for power users
- **Comfortable**: Balanced spacing for everyday use (default)
- **Spacious**: Generous spacing for easier reading and accessibility

## User Interface

### Settings Page
Navigate to **Settings > Appearance** to access the full customization interface:
- Visual theme selector with icons
- Layout density options with descriptions
- Live preview showing how changes will look
- Automatic saving - no save button needed!

### Quick Theme Toggle
A theme toggle button is available in the header for quick switching:
- **Desktop**: Located in the top navigation bar
- **Mobile**: Accessible in the mobile menu
- Click to open a dropdown with all theme options

## Technical Implementation

### Architecture

#### 1. ThemeProvider Context (`src/contexts/ThemeContext.tsx`)
- Manages global theme and layout density state
- Syncs with user preferences from database
- Falls back to localStorage for non-authenticated users
- Listens to system theme changes when in "system" mode

#### 2. Theme Toggle Component (`src/components/common/ThemeToggle.tsx`)
- Dropdown menu for quick theme switching
- Shows current theme with appropriate icon
- Available in both desktop and mobile layouts

#### 3. App Customization Page (`src/pages/settings/AppCustomization.tsx`)
- Full customization interface
- Live preview of settings
- Instant feedback with toast notifications
- Visual indicators for selected options

#### 4. CSS Variables (`src/index.css`)
Layout density is implemented using CSS custom properties:
```css
:root {
  --spacing-unit: 1rem;
  --card-padding: 1.5rem;
  --section-spacing: 2rem;
  --button-height: 2.5rem;
  --input-height: 2.5rem;
}

.density-compact {
  --spacing-unit: 0.75rem;
  --card-padding: 1rem;
  --section-spacing: 1.5rem;
  --button-height: 2rem;
  --input-height: 2rem;
}

.density-spacious {
  --spacing-unit: 1.25rem;
  --card-padding: 2rem;
  --section-spacing: 2.5rem;
  --button-height: 3rem;
  --input-height: 3rem;
}
```

### Integration Points

#### App.tsx
```tsx
<Router>
  <AuthProvider>
    <ThemeProvider>
      <AppContent />
    </ThemeProvider>
  </AuthProvider>
</Router>
```

The ThemeProvider wraps the entire application, ensuring theme and layout preferences are available everywhere.

#### Header.tsx
The header includes the ThemeToggle component for quick access:
- Desktop: In the main navigation bar
- Mobile: In the collapsible menu

### Data Persistence

#### Authenticated Users
Settings are stored in the `profiles` table:
- `ui_theme`: 'light' | 'dark' | 'system'
- `layout_density`: 'compact' | 'comfortable' | 'spacious'

Changes are automatically saved to the database when modified.

#### Non-Authenticated Users
Settings are stored in browser localStorage:
- `theme`: User's theme preference
- `layoutDensity`: User's layout density preference

### Theme Application

The theme is applied by adding/removing the `dark` class on the document root:
```typescript
// Light mode
document.documentElement.classList.remove('dark');

// Dark mode
document.documentElement.classList.add('dark');

// System mode
const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
document.documentElement.classList.toggle('dark', isDark);
```

### Layout Density Application

Layout density is applied by adding a class to the document root:
```typescript
document.documentElement.classList.add(`density-${layoutDensity}`);
```

This allows CSS variables to cascade throughout the application.

## Usage Examples

### Using the Theme Context in Components

```tsx
import { useTheme } from '@/contexts/ThemeContext';

function MyComponent() {
  const { theme, layoutDensity, setTheme, setLayoutDensity, effectiveTheme } = useTheme();
  
  return (
    <div>
      <p>Current theme: {effectiveTheme}</p>
      <p>Layout density: {layoutDensity}</p>
      <button onClick={() => setTheme('dark')}>Switch to Dark</button>
    </div>
  );
}
```

### Accessing Theme Values

```tsx
const { theme, effectiveTheme } = useTheme();

// theme: 'light' | 'dark' | 'system' (user's preference)
// effectiveTheme: 'light' | 'dark' (actual applied theme)
```

### Responsive to Layout Density

Components can adapt to layout density using CSS variables:
```tsx
<div className="p-[var(--card-padding)]">
  Content with density-aware padding
</div>
```

Or conditionally in JSX:
```tsx
const { layoutDensity } = useTheme();

<Button size={
  layoutDensity === 'compact' ? 'sm' : 
  layoutDensity === 'spacious' ? 'lg' : 
  'default'
}>
  Adaptive Button
</Button>
```

## Benefits

### For Users
- **Personalization**: Customize the interface to match preferences
- **Accessibility**: Choose spacing that works best for their needs
- **Comfort**: Reduce eye strain with dark mode
- **Consistency**: Settings persist across sessions

### For Developers
- **Centralized Management**: Single source of truth for theme/layout
- **Easy Integration**: Simple hook-based API
- **Automatic Persistence**: No manual save/load logic needed
- **Type Safety**: Full TypeScript support

## Browser Compatibility

- Modern browsers with CSS custom properties support
- System theme detection via `prefers-color-scheme`
- Graceful fallback to light mode if system preference unavailable

## Performance

- Minimal re-renders with React Context
- CSS-based theme switching (no JavaScript overhead)
- Efficient localStorage/database operations
- Debounced system theme change listener

## Future Enhancements

Potential improvements for the customization system:
- Custom color scheme builder
- Font size adjustments
- Animation speed controls
- High contrast mode
- Color blind friendly palettes
- Export/import settings

## Troubleshooting

### Theme not persisting
- Check browser localStorage permissions
- Verify database connection for authenticated users
- Ensure ThemeProvider wraps the app correctly

### Layout density not applying
- Verify CSS custom properties are supported
- Check that density class is on document root
- Ensure components use CSS variables

### System theme not working
- Verify browser supports `prefers-color-scheme`
- Check that theme is set to "system" mode
- Test with OS theme changes

## Summary

The app customization system provides a robust, user-friendly way to personalize the application experience. With automatic persistence, seamless integration, and comprehensive options, users can tailor the interface to their exact preferences while developers benefit from a clean, maintainable architecture.
